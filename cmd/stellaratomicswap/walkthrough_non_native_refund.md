# Stellar atomic swap refund walkthrough

A walkthrough of a failed  atomic swap of a [custom issued Stellar testnet bitcoin](https://github.com/threefoldtech/rivine/blob/master/research/stellar/examples/issuetoken/readme.md), BTC:GDPHIMRSUSZNLNFWW7VJWWQ2NCH6D6ZVJ4RIME3FUGZLJRS3KKNIVYQ5 in our case and bitcoin 

## perequisites

## Example

Let's assume Bob wants to buy 0.05 XLMBTC from Alice for 0.05BTC

### initiate step

Bob uses an existing Stellar account ( or creates a new one): *GADXVG3VLC7WQ5L3OQNFQ7XB7PPDSR3TVJ2PKJT4IEI5IJBXAZM7YUSL*

Bob has to make sure a trustline exists for his account for XLMBTC( BTC:GDPHIMRSUSZNLNFWW7VJWWQ2NCH6D6ZVJ4RIME3FUGZLJRS3KKNIVYQ5 ).

Bob sends this address to Alice who uses it to initiate the swap.
command:`stellaratomicswap [-testnet] -asset <code:issuer initiate <initiator seed> <participant address> <amount>`
The refund transaction can not be sent until the locktime expires, but should be saved in case a refund is necessary.

```sh
$ ./stellaratomicswap -testnet -asset BTC:GDPHIMRSUSZNLNFWW7VJWWQ2NCH6D6ZVJ4RIME3FUGZLJRS3KKNIVYQ5 initiate SA76XPCY3SRDDPPBX2EUIH3D7TZ7BVWE7LVSBGNTV5ZYLNCVCOHGPD65 GADXVG3VLC7WQ5L3OQNFQ7XB7PPDSR3TVJ2PKJT4IEI5IJBXAZM7YUSL 0.05 
Secret:      0a8941cf458ac3d6a84c89286605c9a086c9d92f29f1d3d18c6f242b93259ced
Secret hash: 459a2aedafa65181fa23b5b312cf7c6c84cd76f170b4bfb68b8728301d64e041

initiator address: GBOEIZUDHR3ZKWQIYNHDIAEQZ4WMSH7JJKTQMTFKZVALTPPTVY7LCRZV
holding account address: GCGTWWSOMES5CIEN5E2QWGB7ZNR5NS63DVRXYMDJ5OCLFY7AOQKNDLP6
refund transaction:
AAAAAI07Wk5hJdEgjek1Cxg/y2PWy9sdY3wwaeuEsuPgdBTRAAABLAABwJIAAAACAAAAAQAAAABdxYm4AAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAehIAAAAAEAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAGAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAAAAAAAAAEAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAIAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAAAAAAA=
```

Alice sends the secret hash and the refund transaction to Bob together with her bitcoin address.

### refund tokens

Bob fails to participate so after the timeout she reclaims her funds:

command:`stellaratomicswap  [-testnet] refund <refund transaction>`

```sh
***TransactionSuccess dump***
    Links: {{https://horizon-testnet.stellar.org/transactions/6c04e062820c3ae1f8218d71e52f4c2d47272177ef83b6cb4c435f679503d876 false}}
    Hash: 6c04e062820c3ae1f8218d71e52f4c2d47272177ef83b6cb4c435f679503d876
    Ledger: 164473
    Env: AAAAAI07Wk5hJdEgjek1Cxg/y2PWy9sdY3wwaeuEsuPgdBTRAAABLAABwJIAAAACAAAAAQAAAABdxYm4AAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAehIAAAAAEAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAGAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAAAAAAAAAEAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAIAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAAAAAAA=
    Result: AAAAAAAAASwAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAGAAAAAAAAAAAAAAAIAAAAAAAAAAAF9d5EAAAAAA==
    Meta: AAAAAQAAAAIAAAADAAKCeQAAAAAAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAABfXeRAABwJIAAAABAAAABAAAAAAAAAAAAAAAAAACAgIAAAADAAAAAAd6m3VYv2h1e3QaWH7h+945R3OqdPUmfEER1CQ3Bln8AAAAAQAAAAFsBOBiggw64fghjXHlL0wtRychd++DtstMQ19nlQPYdgAAAAIAAAACRZoq7a+mUYH6I7WzEs98bITNdvFwtL+2i4coMB1k4EEAAAABAAAAAAAAAAAAAAABAAKCeQAAAAAAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAABfXeRAABwJIAAAACAAAAAwAAAAAAAAAAAAAAAAACAgIAAAACAAAAAAd6m3VYv2h1e3QaWH7h+945R3OqdPUmfEER1CQ3Bln8AAAAAQAAAAJFmirtr6ZRgfojtbMSz3xshM128XC0v7aLhygwHWTgQQAAAAEAAAAAAAAAAAAAAAMAAAAEAAAAAwABwJMAAAABAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAO4uHwAAAABdIdugAAAAAAQAAAAAAAAAAAAAAAQACgnkAAAABAAAAAFxEZoM8d5VaCMNONACQzyzJH+lKpwZMqs1Aub3zrj6xAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAO5Mo4AAAABdIdugAAAAAAQAAAAAAAAAAAAAAAwABwJMAAAABAAAAAI07Wk5hJdEgjek1Cxg/y2PWy9sdY3wwaeuEsuPgdBTRAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAehIAAAAAAAB6EgAAAAAQAAAAAAAAAAAAAAAQACgnkAAAABAAAAAI07Wk5hJdEgjek1Cxg/y2PWy9sdY3wwaeuEsuPgdBTRAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAAAAAAAAAAAAAAAB6EgAAAAAQAAAAAAAAAAAAAABAAAAAMAAoJ5AAAAAQAAAACNO1pOYSXRII3pNQsYP8tj1svbHWN8MGnrhLLj4HQU0QAAAAFCVEMAAAAAAN50MjKkstW0trfqm1oaaI/h+zVPIoYTZaGytMZbUpqKAAAAAAAAAAAAAAAAAAehIAAAAAEAAAAAAAAAAAAAAAIAAAABAAAAAI07Wk5hJdEgjek1Cxg/y2PWy9sdY3wwaeuEsuPgdBTRAAAAAUJUQwAAAAAA3nQyMqSy1bS2t+qbWhpoj+H7NU8ihhNlobK0xltSmooAAAADAAKCeQAAAAAAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNEAAAAABfXeRAABwJIAAAACAAAAAwAAAAAAAAAAAAAAAAACAgIAAAACAAAAAAd6m3VYv2h1e3QaWH7h+945R3OqdPUmfEER1CQ3Bln8AAAAAQAAAAJFmirtr6ZRgfojtbMSz3xshM128XC0v7aLhygwHWTgQQAAAAEAAAAAAAAAAAAAAAEAAoJ5AAAAAAAAAACNO1pOYSXRII3pNQsYP8tj1svbHWN8MGnrhLLj4HQU0QAAAAAF9d5EAAHAkgAAAAIAAAACAAAAAAAAAAAAAAAAAAICAgAAAAIAAAAAB3qbdVi/aHV7dBpYfuH73jlHc6p09SZ8QRHUJDcGWfwAAAABAAAAAkWaKu2vplGB+iO1sxLPfGyEzXbxcLS/touHKDAdZOBBAAAAAQAAAAAAAAAAAAAABAAAAAMAAcCTAAAAAAAAAABcRGaDPHeVWgjDTjQAkM8syR/pSqcGTKrNQLm9864+sQAAABc8iyNEAABAhgAAAAUAAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAEAAoJ5AAAAAAAAAABcRGaDPHeVWgjDTjQAkM8syR/pSqcGTKrNQLm9864+sQAAABdCgQGIAABAhgAAAAUAAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAMAAoJ5AAAAAAAAAACNO1pOYSXRII3pNQsYP8tj1svbHWN8MGnrhLLj4HQU0QAAAAAF9d5EAAHAkgAAAAIAAAACAAAAAAAAAAAAAAAAAAICAgAAAAIAAAAAB3qbdVi/aHV7dBpYfuH73jlHc6p09SZ8QRHUJDcGWfwAAAABAAAAAkWaKu2vplGB+iO1sxLPfGyEzXbxcLS/touHKDAdZOBBAAAAAQAAAAAAAAAAAAAAAgAAAAAAAAAAjTtaTmEl0SCN6TULGD/LY9bL2x1jfDBp64Sy4+B0FNE=
```